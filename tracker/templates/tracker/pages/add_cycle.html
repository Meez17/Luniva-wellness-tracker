{% extends "tracker/base.html" %}
{% block title %}Add Cycle - Luniva{% endblock %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<div class="container pastel-bg" style="max-width: 1100px; margin-top: 30px;">
  <div class="card-body">
    <div class="text-center mb-4">
      <img src="{% static 'images/heart.gif' %}" alt="Cycle gif" style="max-width: 200px;">
    </div>

    <h3 class="text-center mb-3" style="color:#A18BD0;">üîÑ Log a Cycle</h3>
      <p class="text-center text-muted mb-4"> <strong>  Track your menstrual cycle by logging regular or irregular flow days.</strong></p>
        <p class="text-center text-muted mb-4"> Remember:Accurate logging helps us tailor your experience and provide meaningful insights. <br>
            Thank you for taking the time to log your cycle!</p>
    
    {% if form.errors %}
      <div class="alert alert-danger">
        <ul>
          {% for field in form %}
            {% for error in field.errors %}
              <li><strong>{{ field.label }}:</strong> {{ error }}</li>
            {% endfor %}
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="post" id="cycle-form">
      {% csrf_token %}
      <div class="mb-3">
        <p> Do you have an irregular flow?</p>
        <p>
          <small class="text-muted">Check this box if your menstrual cycle is irregular (varies in length or flow).</small>
        </p> {{ form.is_irregular }} {{ form.is_irregular.label_tag }}
      </div>

      <div id="regular-fields">
        <label class="form-label">Start Date</label>
        {{ form.start_date }}
        <label class="form-label mt-2">End Date</label>
        {{ form.end_date }}
      </div>

      <div id="irregular-fields" style="display:none;">
        <label class="form-label">Select Flow Days</label>
        <input id="irregular-calendar" class="form-control" placeholder="Click to select multiple days">
        {{ form.irregular_days }}
        <small class="form-text text-muted">Selected days will be saved as an irregular cycle.</small>
      </div>

      <div class="mb-3 mt-3">
        <label class="form-label">Flow Intensity</label>
        {{ form.flow_type }}
      </div>

      <div class="mb-3">
        <label class="form-label">Notes</label>
        {{ form.notes }}
      </div>

      <div class="d-flex justify-content-between mt-4">
        <a href="{% url 'dashboard' %}" class="btn btn-pink">‚Üê Back</a>
        <button type="submit" class="btn btn-purple">Save Cycle</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const isIrregularCheckbox = document.querySelector('input[name="is_irregular"]');
  const irregularFields = document.getElementById('irregular-fields');
  const regularFields = document.getElementById('regular-fields');
  const irregularHidden = document.querySelector('input[name="irregular_days"]');

  const fp = flatpickr("#irregular-calendar", {
    mode: "multiple",
    dateFormat: "Y-m-d",
    onChange: function(selectedDates, dateStr, instance) {
      irregularHidden.value = dateStr;
    }
  });

  function toggleMode() {
    if (isIrregularCheckbox.checked) {
      irregularFields.style.display = 'block';
      regularFields.style.display = 'none';
    } else {
      irregularFields.style.display = 'none';
      regularFields.style.display = 'block';
      irregularHidden.value = '';
      fp.clear();
    }
  }

  isIrregularCheckbox.addEventListener('change', toggleMode);
  toggleMode();
});
</script>
{% endblock %}
